@model ChargingPoint.Models.IndividualVehicle

@{
    // Truy xuất thông tin từ bảng Vehicle (Template) liên kết
    var vehicleTemplate = Model.Vehicle;
    var isCar = vehicleTemplate?.VehicleType == "Car";

    // Logic điều hướng chung sử dụng VIN làm định danh
    var editAction = "EditVehicleModal";
    var deleteAction = "DeleteVehicle";

    var iconClass = isCar ? "fa-car" : "fa-motorcycle";
    var colorClass = isCar ? "primary" : "success";
}

<div class="col-md-6 col-lg-4 mb-4">
    <div class="card h-100 shadow-sm vehicle-card border-0">
        <div class="card-header bg-@colorClass text-white border-0 py-3">
            <div class="d-flex justify-content-between align-items-center">
                <h6 class="mb-0 fw-bold">
                    <i class="fas @iconClass me-2"></i>
                    @Model.LicensePlate
                </h6>
                @if (vehicleTemplate?.Manufacturer == "VinFast")
                {
                    <span class="badge bg-white text-@colorClass rounded-pill shadow-sm">
                        <i class="fas fa-check-circle"></i> VinFast
                    </span>
                }
            </div>
            <small class="d-block mt-1 opacity-75">
                @vehicleTemplate?.Manufacturer @vehicleTemplate?.Model (@vehicleTemplate?.Version)
            </small>
        </div>

        <div class="card-body">
            <div class="vehicle-info">
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-barcode"></i> VIN:</span>
                    <span class="info-value text-break">@Model.VIN</span>
                </div>

                <div class="info-row">
                    <span class="info-label"><i class="fas fa-palette"></i> Màu sắc:</span>
                    <span class="info-value">@(Model.Color ?? "N/A")</span>
                </div>

                @if (Model.BatterySOH.HasValue)
                {
                    <div class="info-row">
                        <span class="info-label"><i class="fas fa-heartbeat"></i> Độ khỏe Pin (SOH):</span>
                        <span class="info-value text-@(Model.BatterySOH > 80 ? "success" : "warning")">
                            @Model.BatterySOH%
                        </span>
                    </div>
                }

                <div class="info-row">
                    <span class="info-label"><i class="fas fa-battery-full"></i> Pin & Công suất:</span>
                    <span class="info-value">
                        @(vehicleTemplate?.BatteryUsableKWh) kWh / @(vehicleTemplate?.BatteryType)
                    </span>
                </div>

                <div class="info-row border-0">
                    <span class="info-label"><i class="fas fa-charging-station"></i> Cổng sạc:</span>
                    <span class="info-value">
                        @if (vehicleTemplate?.AcChargingSupport == true)
                        {
                            <span class="badge bg-light text-dark border me-1">AC @(vehicleTemplate.MaxAcChargeKW)kW</span>
                        }
                        @if (vehicleTemplate?.DcChargingSupport == true)
                        {
                            <span class="badge bg-warning text-dark border">DC @(vehicleTemplate.MaxDcChargeKW)kW</span>
                        }
                    </span>
                </div>
            </div>
        </div>

        <div class="card-footer bg-white border-top-0 d-flex justify-content-between pb-3">
            <button class="btn btn-outline-warning btn-sm px-3"
                    hx-get="@Url.Action(editAction, "Customer", new { vin = Model.VIN })"
                    hx-target="#modalContainer"
                    hx-swap="innerHTML">
                <i class="fas fa-edit me-1"></i> Sửa
            </button>

            <form method="post"
                  hx-post="@Url.Action(deleteAction, "Customer", new { vin = Model.VIN })"
                  hx-target="#vehicleList"
                  hx-swap="outerHTML"
                  hx-confirm="Bạn có chắc muốn xóa xe @Model.LicensePlate (VIN: @Model.VIN) không?"
                  class="m-0">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-outline-danger btn-sm px-3">
                    <i class="fas fa-trash me-1"></i> Xóa
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    .vehicle-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border-radius: 15px;
    }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        }

    .vehicle-info {
        font-size: 0.88rem;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px dashed #eee;
    }

    .info-label {
        color: #7f8c8d;
        font-weight: 500;
    }

        .info-label i {
            width: 20px;
            color: #95a5a6;
        }

    .info-value {
        font-weight: 600;
        color: #2c3e50;
        max-width: 60%;
        text-align: right;
    }

    .opacity-75 {
        opacity: 0.75;
    }
</style>