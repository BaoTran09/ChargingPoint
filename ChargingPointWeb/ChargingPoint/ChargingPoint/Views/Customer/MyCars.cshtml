@model IEnumerable<ChargingPoint.Models.Vehicle>
@{
    ViewData["Title"] = "Xe ô tô của tôi";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>
            <i class="fas fa-car"></i> @ViewData["Title"]
        </h3>
        <button class="btn btn-success"
                hx-get="@Url.Action("CreateCarModal", "Customer")"
                hx-target="#modalContainer"
                hx-swap="innerHTML">
            <i class="fas fa-plus"></i> Thêm xe ô tô
        </button>
    </div>

    <!-- Modal Container - Để modal render vào đây -->
    <div id="modalContainer"></div>

    @if (!Model.Any())
    {
        <div class="text-center py-5">
            <div class="mb-4">
                <i class="fas fa-car fa-5x text-muted"></i>
            </div>
            <h5 class="text-muted mb-3">Bạn chưa có xe ô tô nào</h5>
            <p class="text-muted">Thêm xe đầu tiên để có thể sử dụng dịch vụ sạc</p>
            <button class="btn btn-primary btn-lg"
                    hx-get="@Url.Action("CreateCarModal", "Customer")"
                    hx-target="#modalContainer"
                    hx-swap="innerHTML">
                <i class="fas fa-plus"></i> Thêm xe đầu tiên
            </button>
        </div>
    }
    else
    {
        <div class="row g-4" id="vehicleList">
            @foreach (var vehicle in Model)
            {
                <partial name="_VehicleCard" model="vehicle" />
            }
        </div>
    }
</div>

@section Scripts {
    <!-- HTMX Library -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <script>
        // Global HTMX event handlers
        document.body.addEventListener('htmx:afterSwap', function(event) {
            // Khi vehicleList được update (sau khi thêm/sửa/xóa)
            if (event.detail.target.id === 'vehicleList') {
                console.log('Vehicle list updated');
                
                // Đóng modal nếu đang mở
                const modalElement = document.getElementById('vehicleModal');
                if (modalElement) {
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                }
            }
        });

        // Cleanup modal backdrop khi cần
        document.body.addEventListener('htmx:beforeSwap', function(event) {
            // Remove stray backdrops
            document.querySelectorAll('.modal-backdrop').forEach(function(backdrop) {
                if (!document.querySelector('.modal.show')) {
                    backdrop.remove();
                }
            });
        });
    </script>
}

<style>
    /* Vehicle List Styles */
    #vehicleList {
        min-height: 200px;
    }

    /* Smooth transitions */
    .card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    /* Empty state */
    .text-center.py-5 i {
        opacity: 0.3;
    }
</style>