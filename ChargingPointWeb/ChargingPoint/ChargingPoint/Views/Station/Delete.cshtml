@model ChargingPoint.DB.Station
@{
    ViewData["Title"] = "Xóa trạm sạc";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="content-wrapper">
    <!-- Header -->
    <div class="d-flex align-items-center justify-content-between mb-5">
        <div>
            <nav class="breadcrumb-nav mb-2">
                <a asp-action="Index" class="text-decoration-none text-secondary">Quản lý trạm sạc</a>
                <span class="mx-2 text-secondary">/</span>
                <a asp-action="Details" asp-route-id="@Model.StationId" class="text-decoration-none text-secondary">#@Model.Tag</a>
                <span class="mx-2 text-secondary">/</span>
                <span class="text-danger fw-semibold">Xóa trạm</span>
            </nav>
            <h2 class="fw-bold mb-1 text-danger">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                Xác nhận xóa trạm sạc
            </h2>
            <p class="text-secondary mb-0">
                Hành động này <strong>không thể hoàn tác</strong>. Tất cả dữ liệu liên quan sẽ bị xóa vĩnh viễn.
            </p>
        </div>
        <a asp-action="Details" asp-route-id="@Model.StationId" class="btn btn-outline-secondary px-4">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
    </div>

    <div class="row g-5">
        <!-- Warning Card -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-5">
                    <!-- Danger Alert -->
                    <div class="alert alert-danger border-0 rounded mb-5 d-flex align-items-start gap-3">
                        <i class="bi bi-shield-fill-exclamation fs-1 text-danger flex-shrink-0"></i>
                        <div>
                            <h5 class="mb-2">Bạn có chắc chắn muốn xóa trạm sạc này?</h5>
                            <p class="mb-0 text-danger-emphasis">
                                <strong>#@Model.Tag – @Model.Name</strong><br>
                                Sau khi xóa, toàn bộ Charger, Connector và lịch sử phiên sạc tại trạm này sẽ bị xóa vĩnh viễn.
                            </p>
                        </div>
                    </div>

                    <!-- Station Info Preview -->
                    <div class="bg-light rounded-3 p-4 mb-5">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="flex-shrink-0">
                                        <div class="bg-success bg-opacity-10 text-success rounded-circle p-3">
                                            <i class="bi bi-ev-station-fill fs-3"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <small class="text-secondary d-block">Mã trạm</small>
                                        <strong class="fs-5">#@Model.Tag</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="flex-shrink-0">
                                        <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-3">
                                            <i class="bi bi-building-fill fs-3"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <small class="text-secondary d-block">Tên trạm</small>
                                        <strong class="fs-5">@Model.Name</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="flex-shrink-0">
                                        <div class="bg-info bg-opacity-10 text-info rounded-circle p-3">
                                            <i class="bi bi-geo-alt-fill fs-3"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <small class="text-secondary d-block">Địa chỉ</small>
                                        <span class="fw-medium">@Model.Address</span>
                                    </div>
                                </div>
                            </div>
                            @if (!string.IsNullOrEmpty(Model.Notes))
                            {
                                <div class="col-12">
                                    <div class="d-flex align-items-start gap-3">
                                        <div class="flex-shrink-0">
                                            <div class="bg-secondary bg-opacity-10 text-secondary rounded-circle p-3">
                                                <i class="bi bi-sticky-fill fs-3"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <small class="text-secondary d-block">Ghi chú</small>
                                            <span class="text-secondary">@Model.Notes</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Confirm Delete Form -->
                    <form asp-action="Delete" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="StationId" />

                        <div class="d-flex justify-content-end gap-3">
                            <a asp-action="Details" asp-route-id="@Model.StationId"
                               class="btn btn-outline-secondary px-5 py-3 d-flex align-items-center gap-2">
                                <i class="bi bi-x-circle"></i>
                                <span class="fw-medium">Hủy bỏ</span>
                            </a>
                            <button type="submit"
                                    class="btn btn-danger px-5 py-3 d-flex align-items-center gap-2 shadow-sm"
                                    onclick="return confirm('⚠️ Bạn có chắc chắn muốn xóa trạm #@Model.Tag?\n\nHành động này KHÔNG THỂ HOÀN TÁC!')">
                                <i class="bi bi-trash-fill"></i>
                                <span class="fw-medium">Xóa vĩnh viễn</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Mini Map Preview -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm sticky-top" style="top: 100px;">
                <div class="card-header bg-transparent border-bottom py-3">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-geo-alt-fill text-success me-2"></i>Vị trí trạm
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div id="map" style="height: 400px; border-radius: 0 0 var(--radius) var(--radius);"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        $(function () {
            const lat = @Model.Latitude?.ToString(System.Globalization.CultureInfo.InvariantCulture) ?? 0;
            const lng = @Model.Longitude?.ToString(System.Globalization.CultureInfo.InvariantCulture) ?? 0;

            if (lat && lng) {
                const map = L.map('map').setView([lat, lng], 16);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap'
                }).addTo(map);

                const dangerIcon = L.divIcon({
                    html: `<div style="background:#ef4444;width:48px;height:48px;border-radius:50%;border:5px solid white;box-shadow:0 6px 20px rgba(239,68,68,0.6);display:flex;align-items:center;justify-content:center;animation:pulse-red 2s infinite;">
                                     <i class="bi bi-ev-station-fill text-white fs-3"></i>
                                   </div>`,
                    iconSize: [48, 48],
                    iconAnchor: [24, 48]
                });

                L.marker([lat, lng], { icon: dangerIcon })
                    .addTo(map)
                    .bindPopup(`<b class="text-danger">#@Model.Tag – @Model.Name</b><br><small class="text-danger">Sắp bị xóa vĩnh viễn</small>`)
                    .openPopup();
            }
        });

        // Red pulse animation
        const style = document.createElement('style');
        style.textContent = `
                    @@keyframes pulse-red {
                        0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6); }
                        70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
                        100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
                    }
                `;
        document.head.appendChild(style);
    </script>

    <style>
        .alert-danger {
            background: linear-gradient(90deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 5px solid #ef4444;
        }

        .bg-light {
            background: var(--bg-secondary) !important;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg) !important;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            border: none;
        }

            .btn-danger:hover {
                background: #b91c1c;
                transform: translateY(-1px);
            }
    </style>
}